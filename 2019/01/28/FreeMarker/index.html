<!-- build time:Sat Feb 23 2019 15:22:01 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="theme-color" content="#202020"><meta http-equiv="x-ua-compatible" content="ie=edge"><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><meta name="keywords" content="FreeMarker,"><meta name="description" content="FreeMarker"><link rel="icon" type="image/x-icon" href="/img/swuixw.png"><title>FreeMarker [ 筱炜的博客 ]</title><link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" href="/css/xoxo.css"></head><body><div class="nav-container"><nav class="home-menu pure-menu pure-menu-horizontal"><a class="pure-menu-heading" href="/"><img class="avatar" src="https://swushxw.github.io/img/swuixw.png"> <span class="title">筱炜的博客</span></a><ul class="pure-menu-list clearfix"><li class="pure-menu-item"><a href="/" class="pure-menu-link">首页</a></li><li class="pure-menu-item"><a href="/tags" class="pure-menu-link">标签</a></li><li class="pure-menu-item"><a href="/about" class="pure-menu-link">关于</a></li></ul></nav></div><div class="container" id="content-outer"><div class="inner" id="content-inner"><div class="post-container"><article class="post" id="post"><header class="post-header text-center"><h1 class="title">FreeMarker</h1><span><time class="time" datetime="2019-01-28T04:23:05.000Z">2019-01-28 </time></span><span class="slash">/</span> <span class="post-meta"><span class="post-tags"><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/public/tags/FreeMarker/">FreeMarker</a></li></ul></span></span><span class="slash">/</span> <span class="read"><span id="busuanzi_value_page_pv"></span> 点击 </span><span class="slash">/</span></header><div class="post-content"><p>FreeMarker是一款用Java编写的模板引擎： 即一种基于模板和要改变的数据，并用来生成输出文本(HTML网页、电子邮件、配置文件、源代码等)的通用工具。是一个Java类库。</p><p>​ FreeMarker 与 Web 容器无关，即在 Web 运行时，它并不知道 Servlet 或 HTTP。它不仅 可以用作表现层的实现技术，而且还可以用于生成 XML，JSP 或 Java 等。</p><a id="more"></a><h3 id="模板引擎执行流程"><a href="#模板引擎执行流程" class="headerlink" title="模板引擎执行流程"></a><strong>模板引擎执行流程</strong></h3><p><img src="https://gss0.bdstatic.com/-4o3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=72bf38a83987e950561afb3e71513826/738b4710b912c8fc0771c1a6ff039245d78821de.jpg" alt=""></p><p><img src="https://gss1.bdstatic.com/-vo3dSag_xI4khGkpoWK1HF6hhy/baike/c0%3Dbaike80%2C5%2C5%2C80%2C26/sign=086de59297ef76c6c4dff379fc7f969f/faedab64034f78f01a86ad407e310a55b2191cf7.jpg" alt=""></p><p><strong>FreeMarker语法</strong></p><p>FreeMarker的模板文件并不比HTML页面复杂多少,FreeMarker模板文件主要由如下4个部分组成:</p><ol><li>文本:直接输出的部分</li><li>注释:&lt;#– … –&gt;格式部分,不会输出</li><li>插值:即${…}或#{…}格式的部分,将使用数据模型中的部分替代输出</li><li>FTL指令:FreeMarker指定,和HTML标记类似,名字前加#予以区分,不会输出</li></ol><p>下面是一个FreeMarker模板的例子,包含了以上所说的4个部分</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Welcome!<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#--</span> 注释部分 <span class="attr">--</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#--</span> 下面使用插值 <span class="attr">--</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome $&#123;user&#125; !<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>We have these animals:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">u1</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#--</span> 使用<span class="attr">FTL</span>指令 <span class="attr">--</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#list</span> <span class="attr">animals</span> <span class="attr">as</span> <span class="attr">being</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>$&#123;being.name&#125; for $&#123;being.price&#125; Euros<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#list</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">u1</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="FTL指令规则"><a href="#FTL指令规则" class="headerlink" title="FTL指令规则"></a><strong>FTL指令规则</strong></h3><p>在FreeMarker中,使用FTL标签来使用指令,FreeMarker有3种FTL标签,这和HTML标签是完全类似的.</p><ol><li>开始标签:&lt;#directivename parameter&gt;</li><li>结束标签:&lt;/#directivename&gt;</li><li>空标签:&lt;#directivename parameter/&gt;</li></ol><p>实际上,使用标签时前面的符号#也可能变成@,如果该指令是一个用户指令而不是系统内建指令时,应将#符号改成@符号.</p><p>使用FTL标签时,应该有正确的嵌套,而不是交叉使用,这和XML标签的用法完全一样.如果全用不存在的指令,FreeMarker不会使用模板输出,而是产生一个错误消息.FreeMarker会忽略FTL标签中的空白字符.值得注意的是&lt; , /&gt; 和指令之间不允许有空白字符.</p><h3 id="插值规则"><a href="#插值规则" class="headerlink" title="插值规则"></a><strong>插值规则</strong></h3><p>FreeMarker的插值有如下两种类型:1,通用插值${expr};2,数字格式化插值:#{expr}或#{expr;format}</p><p><strong>通用插值</strong></p><p>对于通用插值,又可以分为以下4种情况:</p><p>1,插值结果为字符串值:直接输出表达式结果</p><p>2,插值结果为数字值:根据默认格式(由#setting指令设置)将表达式结果转换成文本输出.可以使用内建的字符串函数格式化单个插值,如下面的例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;#settion number_format=&quot;currency&quot;/&gt;</span><br><span class="line">&lt;#assign answer=42/&gt;</span><br><span class="line">$&#123;answer&#125;</span><br><span class="line">$&#123;answer?string&#125; &lt;#-- the same as $&#123;answer&#125; --&gt;</span><br><span class="line">$&#123;answer?string.number&#125;</span><br><span class="line">$&#123;answer?string.currency&#125;</span><br><span class="line">$&#123;answer?string.percent&#125;</span><br><span class="line">$&#123;answer&#125;</span><br><span class="line">输出结果是:</span><br><span class="line">$42.00</span><br><span class="line">$42.00</span><br><span class="line">42</span><br><span class="line">$42.00</span><br><span class="line">4,200%</span><br></pre></td></tr></table></figure><p>3,插值结果为日期值:根据默认格式(由#setting指令设置)将表达式结果转换成文本输出.可以使用内建的字符串函数格式化单个插值,如下面的例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$&#123;lastUpdated?string(&quot;yyyy-MM-dd HH:mm:ss zzzz&quot;)&#125;</span><br><span class="line">$&#123;lastUpdated?string(&quot;EEE, MMM d, &apos;&apos;yy&quot;)&#125;</span><br><span class="line">$&#123;lastUpdated?string(&quot;EEEE, MMMM dd, yyyy, hh:mm:ss a &apos;(&apos;zzz&apos;)&apos;&quot;)&#125;</span><br><span class="line">输出结果是:</span><br><span class="line">2008-04-08 08:08:08 Pacific Daylight Time</span><br><span class="line">Tue, Apr 8, &apos;03</span><br><span class="line">Tuesday, April 08, 2003, 08:08:08 PM (PDT)</span><br></pre></td></tr></table></figure><p>4,插值结果为布尔值:根据默认格式(由#setting指令设置)将表达式结果转换成文本输出.可以使用内建的字符串函数格式化单个插值,如下面的例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign foo=true/&gt;</span><br><span class="line">$&#123;foo?string(&quot;yes&quot;, &quot;no&quot;)&#125;</span><br><span class="line">输出结果是:</span><br><span class="line">yes</span><br></pre></td></tr></table></figure><p><strong>数字格式化插值</strong></p><p>数字格式化插值可采用#{expr;format}形式来格式化数字,其中format可以是:</p><p>mX:小数部分最小X位</p><p>MX:小数部分最大X位</p><p>如下面的例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign x=2.582/&gt;</span><br><span class="line">&lt;#assign y=4/&gt;</span><br><span class="line">#&#123;x; M2&#125; &lt;#-- 输出2.58 --&gt;</span><br><span class="line">#&#123;y; M2&#125; &lt;#-- 输出4 --&gt;</span><br><span class="line">#&#123;x; m2&#125; &lt;#-- 输出2.6 --&gt;</span><br><span class="line">#&#123;y; m2&#125; &lt;#-- 输出4.0 --&gt;</span><br><span class="line">#&#123;x; m1M2&#125; &lt;#-- 输出2.58 --&gt;</span><br><span class="line">#&#123;x; m1M2&#125; &lt;#-- 输出4.0 --&gt;</span><br></pre></td></tr></table></figure><h3 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a><strong>表达式</strong></h3><p>表达式是FreeMarker模板的核心功能,表达式放置在插值语法${}之中时,表明需要输出表达式的值;表达式语法也可与FreeMarker标签结合,用于控制输出.实际上FreeMarker的表达式功能非常强大,它不仅支持直接指定值,输出变量值,也支持字符串格式化输出和集合访问等功能.</p><p><strong>直接指定值</strong></p><p>使用直接指定值语法让FreeMarker直接输出插值中的值,而不是输出变量值.直接指定值可以是字符串,数值,布尔值,集合和MAP对象.</p><p>1,<em>字符串</em></p><p>直接指定字符串值使用单引号或双引号限定,如果字符串值中包含特殊字符需要转义,看下面的例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;&quot;我的文件保存在C:\\盘&quot;&#125;</span><br><span class="line">$&#123;&apos;我名字是\&quot;annlee\&quot;&apos;&#125;</span><br><span class="line">输出结果是: </span><br><span class="line">我的文件保存在C:\盘</span><br><span class="line">我名字是&quot;annlee&quot;</span><br></pre></td></tr></table></figure><p>FreeMarker支持如下转义字符:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">\&quot;;双引号(u0022)</span><br><span class="line">\&apos;;单引号(u0027)</span><br><span class="line">\\;反斜杠(u005C)</span><br><span class="line">\n;换行(u000A)</span><br><span class="line">\r;回车(u000D)</span><br><span class="line">\t;Tab(u0009)</span><br><span class="line">\b;退格键(u0008)</span><br><span class="line">\f;Form feed(u000C)</span><br><span class="line">\l;&lt;</span><br><span class="line">\g;&gt;</span><br><span class="line">\a;&amp;</span><br><span class="line">\&#123;;&#123;</span><br><span class="line">\xCode;直接通过4位的16进制数来指定Unicode码,输出该unicode码对应的字符.</span><br></pre></td></tr></table></figure><p>如果某段文本中包含大量的特殊符号,FreeMarker提供了另一种特殊格式:可以在指定字符串内容的引号前增加r标记,在r标记后的文件将会直接输出.看如下代码:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$&#123;r&quot;$&#123;foo&#125;&quot;&#125;</span><br><span class="line">$&#123;r&quot;C:\foo\bar&quot;&#125;</span><br><span class="line">输出结果是:</span><br><span class="line">$&#123;foo&#125;</span><br><span class="line">C:\foo\bar</span><br></pre></td></tr></table></figure><p><em>数值</em></p><p>表达式中的数值直接输出,不需要引号.小数点使用”.”分隔,不能使用分组”,”符号.FreeMarker目前还不支持科学计数法,所以”1E3”是错误的.在FreeMarker表达式中使用数值需要注意以下几点:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数值不能省略小数点前面的0,所以&quot;.5&quot;是错误的写法</span><br><span class="line">数值8 , +8 , 8.00都是相同的</span><br></pre></td></tr></table></figure><p><em>布尔值</em></p><p>直接使用true和false,不使用引号.</p><p><em>集合</em></p><p>集合以方括号包括,各集合元素之间以英文逗号”,”分隔,看如下的例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&quot;星期一&quot;, &quot;星期二&quot;, &quot;星期三&quot;, &quot;星期四&quot;, &quot;星期五&quot;, &quot;星期六&quot;, &quot;星期天&quot;] as x&gt;</span><br><span class="line">$&#123;x&#125;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">输出结果是:</span><br><span class="line">星期一</span><br><span class="line">星期二</span><br><span class="line">星期三</span><br><span class="line">星期四</span><br><span class="line">星期五</span><br><span class="line">星期六</span><br><span class="line">星期天</span><br></pre></td></tr></table></figure><p>除此之外,集合元素也可以是表达式,例子如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2 + 2, [1, 2, 3, 4], &quot;whatnot&quot;]</span><br></pre></td></tr></table></figure><p>还可以使用数字范围定义数字集合,如2..5等同于[2, 3, 4, 5],但是更有效率.注意,使用数字范围来定义集合时无需使用方括号,数字范围也支持反递增的数字范围,如5..2</p><p><em>Map对象</em></p><p>Map对象使用花括号包括,Map中的key-value对之间以英文冒号”:”分隔,多组key-value对之间以英文逗号”,”分隔.下面是一个例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;语文&quot;:78, &quot;数学&quot;:80&#125;</span><br></pre></td></tr></table></figure><p>Map对象的key和value都是表达式,但是key必须是字符串</p><p><strong>输出变量值</strong></p><p>FreeMarker的表达式输出变量时,这些变量可以是顶层变量,也可以是Map对象中的变量,还可以是集合中的变量,并可以使用点(.)语法来访问Java对象的属性.下面分别讨论这些情况</p><p><em>顶层变量</em></p><p>所谓顶层变量就是直接放在数据模型中的值,例如有如下数据模型:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map root = new HashMap();   //创建数据模型</span><br><span class="line">root.put(&quot;name&quot;,&quot;annlee&quot;);   //name是一个顶层变量</span><br></pre></td></tr></table></figure><p>对于顶层变量,直接使用${variableName}来输出变量值,变量名只能是字母,数字,下划线,$,@和#的组合,且不能以数字开头号.为了输出上面的name的值,可以使用如下语法:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;name&#125;</span><br></pre></td></tr></table></figure><p><em>输出集合元素</em></p><p>如果需要输出集合元素,则可以根据集合元素的索引来输出集合元素,集合元素的索引以方括号指定.假设有索引:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[&quot;星期一&quot;,&quot;星期二&quot;,&quot;星期三&quot;,&quot;星期四&quot;,&quot;星期五&quot;,&quot;星期六&quot;,&quot;星期天&quot;].该索引名为week,如果需要输出星期三,则可以使用如下语法:</span><br><span class="line">$&#123;week[2]&#125;   //输出第三个集合元素</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">此外,FreeMarker还支持返回集合的子集合,如果需要返回集合的子集合,则可以使用如下语法:</span><br><span class="line">week[3..5]   //返回week集合的子集合,子集合中的元素是week集合中的第4-6个元素</span><br></pre></td></tr></table></figure><p><em>输出Map元素</em></p><p>这里的Map对象可以是直接HashMap的实例,甚至包括JavaBean实例,对于JavaBean实例而言,我们一样可以把其当成属性为key,属性值为value的Map实例.为了输出Map元素的值,可以使用点语法或方括号语法.假如有下面的数据模型:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Map root = new HashMap();</span><br><span class="line">Book book = new Book();</span><br><span class="line">Author author = new Author();</span><br><span class="line">author.setName(&quot;annlee&quot;);</span><br><span class="line">author.setAddress(&quot;gz&quot;);</span><br><span class="line">book.setName(&quot;struts2&quot;);</span><br><span class="line">book.setAuthor(author);</span><br><span class="line">root.put(&quot;info&quot;,&quot;struts&quot;);</span><br><span class="line">root.put(&quot;book&quot;, book);</span><br></pre></td></tr></table></figure><p>为了访问数据模型中名为struts2的书的作者的名字,可以使用如下语法:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">book.author.name    //全部使用点语法</span><br><span class="line">book[&quot;author&quot;].name</span><br><span class="line">book.author[&quot;name&quot;]    //混合使用点语法和方括号语法</span><br><span class="line">book[&quot;author&quot;][&quot;name&quot;]   //全部使用方括号语法</span><br></pre></td></tr></table></figure><p>使用点语法时,变量名字有顶层变量一样的限制,但方括号语法没有该限制,因为名字可以是任意表达式的结果.</p><p><em>字符串操作</em></p><p>FreeMarker的表达式对字符串操作非常灵活,可以将字符串常量和变量连接起来,也可以返回字符串的子串等.</p><p>字符串连接有两种语法:</p><p>1,使用${..}或#{..}在字符串常量部分插入表达式的值,从而完成字符串连接.</p><p>2,直接使用连接运算符+来连接字符串</p><p>例如有如下数据模型:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map root = new HashMap(); root.put(&quot;user&quot;,&quot;annlee&quot;);</span><br></pre></td></tr></table></figure><p>下面将user变量和常量连接起来:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$&#123;&quot;hello, $&#123;user&#125;!&quot;&#125;   //使用第一种语法来连接</span><br><span class="line">$&#123;&quot;hello, &quot; + user + &quot;!&quot;&#125; //使用+号来连接</span><br></pre></td></tr></table></figure><p>上面的输出字符串都是hello,annlee!,可以看出这两种语法的效果完全一样.</p><p>值得注意的是,${..}只能用于文本部分,不能用于表达式,下面的代码是错误的:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if $&#123;isBig&#125;&gt;Wow!&lt;/#if&gt;</span><br><span class="line">&lt;#if &quot;$&#123;isBig&#125;&quot;&gt;Wow!&lt;/#if&gt;</span><br><span class="line">应该写成:&lt;#if isBig&gt;Wow!&lt;/#if&gt;</span><br></pre></td></tr></table></figure><p>截取子串可以根据字符串的索引来进行,截取子串时如果只指定了一个索引值,则用于取得字符串中指定索引所对应的字符;如果指定两个索引值,则返回两个索引中间的字符串子串.假如有如下数据模型:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map root = new HashMap(); root.put(&quot;book&quot;,&quot;struts2,freemarker&quot;);</span><br><span class="line">可以通过如下语法来截取子串:</span><br><span class="line">$&#123;book[0]&#125;$&#123;book[4]&#125;   //结果是su</span><br><span class="line">$&#123;book[1..4]&#125;     //结果是tru</span><br></pre></td></tr></table></figure><p><em>集合连接运算符</em></p><p>这里所说的集合运算符是将两个集合连接成一个新的集合,连接集合的运算符是+,看如下的例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list [&quot;星期一&quot;,&quot;星期二&quot;,&quot;星期三&quot;] + [&quot;星期四&quot;,&quot;星期五&quot;,&quot;星期六&quot;,&quot;星期天&quot;] as x&gt;</span><br><span class="line">$&#123;x&#125;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">输出结果是:星期一 星期二 星期三 星期四 星期五 星期六 星期天</span><br></pre></td></tr></table></figure><p><em>Map连接运算符</em></p><p>Map对象的连接运算符也是将两个Map对象连接成一个新的Map对象,Map对象的连接运算符是+,如果两个Map对象具有相同的key,则右边的值替代左边的值.看如下的例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign scores = &#123;&quot;语文&quot;:86,&quot;数学&quot;:78&#125; + &#123;&quot;数学&quot;:87,&quot;Java&quot;:93&#125;&gt;</span><br><span class="line">语文成绩是$&#123;scores.语文&#125;</span><br><span class="line">数学成绩是$&#123;scores.数学&#125;</span><br><span class="line">Java成绩是$&#123;scores.Java&#125;</span><br><span class="line">输出结果是:</span><br><span class="line">语文成绩是86</span><br><span class="line">数学成绩是87</span><br><span class="line">Java成绩是93</span><br></pre></td></tr></table></figure><p><em>算术运算符</em></p><p>FreeMarker表达式中完全支持算术运算,FreeMarker支持的算术运算符包括:+, - , * , / , % 看如下的代码:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign x=5&gt;</span><br><span class="line">$&#123; x * x - 100 &#125;</span><br><span class="line">$&#123; x /2 &#125;</span><br><span class="line">$&#123; 12 %10 &#125;</span><br><span class="line">输出结果是:</span><br><span class="line">-75   2.5   2</span><br></pre></td></tr></table></figure><p>在表达式中使用算术运算符时要注意以下几点:</p><p>1,运算符两边的运算数字必须是数字</p><p>2,使用+运算符时,如果一边是数字,一边是字符串,就会自动将数字转换为字符串再连接,如:${3 + “5”},结果是:35</p><p>使用内建的int函数可对数值取整,如:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign x=5&gt;</span><br><span class="line">$&#123; (x/2)?int &#125;</span><br><span class="line">$&#123; 1.1?int &#125;</span><br><span class="line">$&#123; 1.999?int &#125;</span><br><span class="line">$&#123; -1.1?int &#125;</span><br><span class="line">$&#123; -1.999?int &#125;</span><br><span class="line">结果是:2 1 1 -1 -1</span><br></pre></td></tr></table></figure><p><em>比较运算符比较运算符</em></p><p>表达式中支持的比较运算符有如下几个:</p><ol><li>=或者==:判断两个值是否相等.</li><li>!=:判断两个值是否不等.</li><li>‘&gt;’或者gt:判断左边值是否大于右边值</li><li>‘&gt;=’或者gte:判断左边值是否大于等于右边值</li><li>&lt;或者lt:判断左边值是否小于右边值</li><li>&lt;=或者lte:判断左边值是否小于等于右边值</li></ol><p>注意:=和!=可以用于字符串,数值和日期来比较是否相等,但=和!=两边必须是相同类型的值,否则会产生错误,而且FreeMarker是精确比较,”x”,”x “,”X”是不等的.其它的运行符可以作用于数字和日期,但不能作用于字符串,大部分的时候,使用gt等字母运算符代替&gt;会有更好的效果,因为FreeMarker会把&gt;解释成FTL标签的结束字符,当然,也可以使用括号来避免这种情况,如:&lt;#if (x&gt;y)&gt;</p><p><em>逻辑运算符</em></p><p>逻辑运算符有如下几个:</p><p>逻辑与:&amp;&amp;</p><p>逻辑或:||</p><p>逻辑非:!</p><p>逻辑运算符只能作用于布尔值,否则将产生错误</p><p><em>内建函数</em></p><p>FreeMarker还提供了一些内建函数来转换输出,可以在任何变量后紧跟” ? “,” ? “后紧跟内建函数,就可以通过内建函数来轮换输出变量.下面是常用的内建的字符串函数:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">html:对字符串进行HTML编码</span><br><span class="line">cap_first:使字符串第一个字母大写</span><br><span class="line">lower_case:将字符串转换成小写</span><br><span class="line">upper_case:将字符串转换成大写</span><br><span class="line">trim:去掉字符串前后的空白字符</span><br></pre></td></tr></table></figure><p>下面是集合的常用内建函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">size:获取序列中元素的个数</span><br><span class="line">下面是数字值的常用内建函数</span><br><span class="line">int:取得数字的整数部分,结果带符号</span><br><span class="line">例如:</span><br><span class="line">&lt;#assign test=&quot;Tom &amp; Jerry&quot;&gt;</span><br><span class="line">$&#123;test?html&#125;</span><br><span class="line">$&#123;test?upper_case?html&#125;</span><br><span class="line">结果是:Tom &amp;amp; Jerry   TOM &amp;amp; JERRY</span><br></pre></td></tr></table></figure><p><em>空值处理运算符</em></p><p>FreeMarker对空值的处理非常严格,FreeMarker的变量必须有值,没有被赋值的变量就会抛出异常,因为FreeMarker未赋值的变量强制出错可以杜绝很多潜在的错误,如缺失潜在的变量命名,或者其他变量错误.这里所说的空值,实际上也包括那些并不存在的变量,对于一个Java的null值而言,我们认为这个变量是存在的,只是它的值为null,但对于FreeMarker模板而言,它无法理解null值,null值和不存在的变量完全相同.</p><p>为了处理缺失变量,FreeMarker提供了两个运算符:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">!:指定缺失变量的默认值</span><br><span class="line">??:判断某个变量是否存在</span><br></pre></td></tr></table></figure><p>其中,!运算符的用法有如下两种:</p><p>variable!或variable!defaultValue,第一种用法不给缺失的变量指定默认值,表明默认值是空字符串,长度为0的集合,或者长度为0的Map对象.</p><p>使用!指定默认值时,并不要求默认值的类型和变量类型相同.使用??运算符非常简单,它总是返回一个布尔值,用法为:variable??,如果该变量存在,返回true,否则返回false</p><p><em>运算符的优先级</em></p><p>FreeMarker中的运算符优先级如下(由高到低排列):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1,一元运算符:!</span><br><span class="line">2,内建函数:?</span><br><span class="line">3,乘除法:*, / , %</span><br><span class="line">4,加减法:- , +</span><br><span class="line">5,比较:&gt; , &lt; , &gt;= , &lt;= (lt , lte , gt , gte)</span><br><span class="line">6,相等:== , = , !=</span><br><span class="line">7,逻辑与:&amp;&amp;</span><br><span class="line">8,逻辑或:||</span><br><span class="line">9,数字范围:..</span><br></pre></td></tr></table></figure><p>实际上,我们在开发过程中应该使用括号来严格区分,这样的可读性好,出错少</p><h3 id="FreeMarker的常用指令"><a href="#FreeMarker的常用指令" class="headerlink" title="FreeMarker的常用指令"></a><strong>FreeMarker的常用指令</strong></h3><p>FreeMarker的FTL指令也是模板的重要组成部分,这些指令可实现对数据模型所包含数据的抚今迭代,分支控制.除此之外,还有一些重要的功能,也是通过FTL指令来实现的.</p><p><em>if指令</em></p><p>这是一个典型的分支控制指令,该指令的作用完全类似于Java语言中的if,if指令的语法格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;#if condition&gt;...</span><br><span class="line">&lt;#elseif condition&gt;...</span><br><span class="line">&lt;#elseif condition&gt;...</span><br><span class="line">&lt;#else&gt; ...</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">例子如下:</span><br><span class="line">&lt;#assign age=23&gt;</span><br><span class="line">&lt;#if (age&gt;60)&gt;老年人</span><br><span class="line">&lt;#elseif (age&gt;40)&gt;中年人</span><br><span class="line">&lt;#elseif (age&gt;20)&gt;青年人</span><br><span class="line">&lt;#else&gt; 少年人</span><br><span class="line">&lt;/#if&gt;</span><br><span class="line">输出结果是:青年人</span><br></pre></td></tr></table></figure><p>上面的代码中的逻辑表达式用括号括起来主要是因为里面有&gt;符号,由于FreeMarker会将&gt;符号当成标签的结束字符,可能导致程序出错,为了避免这种情况,我们应该在凡是出现这些符号的地方都使用括号.</p><p><em>switch , case , default , break指令</em></p><p>这些指令显然是分支指令,作用类似于Java的switch语句,switch指令的语法结构如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#switch value&gt;</span><br><span class="line">&lt;#case refValue&gt;...&lt;#break&gt;</span><br><span class="line">&lt;#case refValue&gt;...&lt;#break&gt;</span><br><span class="line">&lt;#default&gt;...</span><br><span class="line">&lt;/#switch&gt;</span><br></pre></td></tr></table></figure><p><em>list, break指令</em></p><p>list指令是一个迭代输出指令,用于迭代输出数据模型中的集合,list指令的语法格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;#list sequence as item&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure><p>上面的语法格式中,sequence就是一个集合对象,也可以是一个表达式,但该表达式将返回一个集合对象,而item是一个任意的名字,就是被迭代输出的集合元素.此外,迭代集合对象时,还包含两个特殊的循环变量:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">item_index:当前变量的索引值</span><br><span class="line">item_has_next:是否存在下一个对象</span><br><span class="line">也可以使用&lt;#break&gt;指令跳出迭代</span><br><span class="line">例子如下:</span><br><span class="line">&lt;#list [&quot;星期一&quot;, &quot;星期二&quot;, &quot;星期三&quot;, &quot;星期四&quot;, &quot;星期五&quot;, &quot;星期六&quot;, &quot;星期天&quot;] as x&gt;</span><br><span class="line">$&#123;x_index + 1&#125;.$&#123;x&#125;&lt;#if x_has_next&gt;,&lt;/if&gt;</span><br><span class="line">&lt;#if x=&quot;星期四&quot;&gt;&lt;#break&gt;&lt;/#if&gt;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure><p><em>include指令</em></p><p>include指令的作用类似于JSP的包含指令,用于包含指定页.include指令的语法格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;#include filename [options]&gt;</span><br><span class="line">在上面的语法格式中,两个参数的解释如下:</span><br><span class="line">filename:该参数指定被包含的模板文件</span><br><span class="line">options:该参数可以省略,指定包含时的选项,包含encoding和parse两个选项,其中encoding指定包含页面时所用的解码集,而parse指定被包含文件是否作为FTL文件来解析,如果省略了parse选项值,则该选项默认是true.</span><br></pre></td></tr></table></figure><p><em>import指令</em></p><p>该指令用于导入FreeMarker模板中的所有变量,并将该变量放置在指定的Map对象中,import指令的语法格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;#import &quot;/lib/common.ftl&quot; as com&gt;</span><br><span class="line">上面的代码将导入/lib/common.ftl模板文件中的所有变量,交将这些变量放置在一个名为com的Map对象中.</span><br></pre></td></tr></table></figure><p><em>noparse指令</em></p><p>noparse指令指定FreeMarker不处理该指定里包含的内容,该指令的语法格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;#noparse&gt;...&lt;/#noparse&gt;</span><br><span class="line">看如下的例子:</span><br><span class="line">&lt;#noparse&gt;</span><br><span class="line">&lt;#list books as book&gt;</span><br><span class="line">   &lt;tr&gt;&lt;td&gt;$&#123;book.name&#125;&lt;td&gt;作者:$&#123;book.author&#125;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;/#noparse&gt;</span><br><span class="line">输出如下:</span><br><span class="line">&lt;#list books as book&gt;</span><br><span class="line">   &lt;tr&gt;&lt;td&gt;$&#123;book.name&#125;&lt;td&gt;作者:$&#123;book.author&#125;</span><br><span class="line">&lt;/#list&gt;</span><br></pre></td></tr></table></figure><p><em>escape , noescape指令</em></p><p>escape指令导致body区的插值都会被自动加上escape表达式,但不会影响字符串内的插值,只会影响到body内出现的插值,使用escape指令的语法格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;#escape identifier as expression&gt;...</span><br><span class="line">&lt;#noescape&gt;...&lt;/#noescape&gt;</span><br><span class="line">&lt;/#escape&gt;</span><br><span class="line">看如下的代码:</span><br><span class="line">&lt;#escape x as x?html&gt;</span><br><span class="line">First name:$&#123;firstName&#125;</span><br><span class="line">Last name:$&#123;lastName&#125;</span><br><span class="line">Maiden name:$&#123;maidenName&#125;</span><br><span class="line">&lt;/#escape&gt;</span><br><span class="line">上面的代码等同于:</span><br><span class="line">First name:$&#123;firstName?html&#125;</span><br><span class="line">Last name:$&#123;lastName?html&#125;</span><br><span class="line">Maiden name:$&#123;maidenName?html&#125;</span><br></pre></td></tr></table></figure><p>escape指令在解析模板时起作用而不是在运行时起作用,除此之外,escape指令也嵌套使用,子escape继承父escape的规则,如下例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;#escape x as x?html&gt;</span><br><span class="line">Customer Name:$&#123;customerName&#125;</span><br><span class="line">Items to ship;</span><br><span class="line">&lt;#escape x as itemCodeToNameMap[x]&gt;</span><br><span class="line">   $&#123;itemCode1&#125;</span><br><span class="line">   $&#123;itemCode2&#125;</span><br><span class="line">   $&#123;itemCode3&#125;</span><br><span class="line">   $&#123;itemCode4&#125;</span><br><span class="line">&lt;/#escape&gt;</span><br><span class="line">&lt;/#escape&gt;</span><br><span class="line">上面的代码类似于:</span><br><span class="line">Customer Name:$&#123;customerName?html&#125;</span><br><span class="line">Items to ship;</span><br><span class="line">$&#123;itemCodeToNameMap[itemCode1]?html&#125;</span><br><span class="line">$&#123;itemCodeToNameMap[itemCode2]?html&#125;</span><br><span class="line">$&#123;itemCodeToNameMap[itemCode3]?html&#125;</span><br><span class="line">$&#123;itemCodeToNameMap[itemCode4]?html&#125;</span><br></pre></td></tr></table></figure><p>对于放在escape指令中所有的插值而言,这此插值将被自动加上escape表达式,如果需要指定escape指令中某些插值无需添加escape表达式,则应该使用noescape指令,放在noescape指令中的插值将不会添加escape表达式.</p><p><em>assign指令</em></p><p>assign指令在前面已经使用了多次,它用于为该模板页面创建或替换一个顶层变量,assign指令的用法有多种,包含创建或替换一个顶层变量,或者创建或替换多个变量等,它的最简单的语法如下:&lt;#assign name=value [in namespacehash]&gt;,这个用法用于指定一个名为name的变量,该变量的值为value,此外,FreeMarker允许在使用assign指令里增加in子句,in子句用于将创建的name变量放入namespacehash命名空间中.</p><p>assign指令还有如下用法:&lt;#assign name1=value1 name2=value2 … nameN=valueN [in namespacehash]&gt;,这个语法可以同时创建或替换多个顶层变量,此外,还有一种复杂的用法,如果需要创建或替换的变量值是一个复杂的表达式,则可以使用如下语法格式:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign x&gt;</span><br><span class="line">&lt;#list [&quot;星期一&quot;, &quot;星期二&quot;, &quot;星期三&quot;, &quot;星期四&quot;, &quot;星期五&quot;, &quot;星期六&quot;, &quot;星期天&quot;] as n&gt;</span><br><span class="line">$&#123;n&#125;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;/#assign&gt;</span><br><span class="line">$&#123;x&#125;</span><br><span class="line">上面的代码将产生如下输出:星期一 星期二 星期三 星期四 星期五 星期六 星期天</span><br></pre></td></tr></table></figure><p>虽然assign指定了这种复杂变量值的用法,但是我们也不要滥用这种用法,如下例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;#assign x&gt;Hello $&#123;user&#125;!&lt;/#assign&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">以上代码改为如下写法更合适:&lt;#assign x=&quot;Hello $&#123;user&#125;!&quot;&gt;</span><br></pre></td></tr></table></figure><p><em>setting指令</em></p><p>该指令用于设置FreeMarker的运行环境,该指令的语法格式如下:&lt;#setting name=value&gt;,在这个格式中,name的取值范围包含如下几个:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">locale:该选项指定该模板所用的国家/语言选项</span><br><span class="line">number_format:指定格式化输出数字的格式</span><br><span class="line">boolean_format:指定两个布尔值的语法格式,默认值是true,false</span><br><span class="line">date_format,time_format,datetime_format:指定格式化输出日期的格式</span><br><span class="line">time_zone:设置格式化输出日期时所使用的时区</span><br></pre></td></tr></table></figure><p><em>macro , nested , return指令</em></p><p>macro可以用于实现自定义指令,通过使用自定义指令,可以将一段模板片段定义成一个用户指令,使用macro指令的语法格式如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro name param1 param2 ... paramN&gt;</span><br><span class="line">...</span><br><span class="line">&lt;#nested loopvar1, loopvar2, ..., loopvarN&gt;</span><br><span class="line">...</span><br><span class="line">&lt;#return&gt;</span><br><span class="line">...</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure><p>在上面的格式片段中,包含了如下几个部分:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name:name属性指定的是该自定义指令的名字,使用自定义指令时可以传入多个参数</span><br><span class="line">paramX:该属性就是指定使用自定义指令时报参数,使用该自定义指令时,必须为这些参数传入值</span><br><span class="line">nested指令:nested标签输出使用自定义指令时的中间部分</span><br><span class="line">nested指令中的循环变量:这此循环变量将由macro定义部分指定,传给使用标签的模板</span><br><span class="line">return指令:该指令可用于随时结束该自定义指令.</span><br></pre></td></tr></table></figure><p>例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro book&gt;   //定义一个自定义指令</span><br><span class="line">j2ee</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@book /&gt;    //使用刚才定义的指令</span><br><span class="line">上面的代码输出结果为:j2ee</span><br></pre></td></tr></table></figure><p>在上面的代码中,可能很难看出自定义标签的用处,因为我们定义的book指令所包含的内容非常简单,实际上,自定义标签可包含非常多的内容,从而可以实现更好的代码复用.此外,还可以在定义自定义指令时,为自定义指令指定参数,看如下代码:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro book booklist&gt;     //定义一个自定义指令booklist是参数</span><br><span class="line">&lt;#list booklist as book&gt;</span><br><span class="line">   $&#123;book&#125;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@book booklist=[&quot;spring&quot;,&quot;j2ee&quot;] /&gt;   //使用刚刚定义的指令</span><br></pre></td></tr></table></figure><p>上面的代码为book指令传入了一个参数值,上面的代码的输出结果为:spring j2ee</p><p>不仅如此,还可以在自定义指令时使用nested指令来输出自定义指令的中间部分,看如下例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro page title&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">   &lt;title&gt;FreeMarker示例页面 - $&#123;title?html&#125;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">   &lt;h1&gt;$&#123;title?html&#125;&lt;/h1&gt;</span><br><span class="line">   &lt;#nested&gt;      //用于引入用户自定义指令的标签体</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br></pre></td></tr></table></figure><p>上面的代码将一个HTML页面模板定义成一个page指令,则可以在其他页面中如此page指令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;#import &quot;/common.ftl&quot; as com&gt;     //假设上面的模板页面名为common.ftl,导入页面</span><br><span class="line">&lt;@com.page title=&quot;book list&quot;&gt;</span><br><span class="line">&lt;u1&gt;</span><br><span class="line">&lt;li&gt;spring&lt;/li&gt;</span><br><span class="line">&lt;li&gt;j2ee&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;/@com.page&gt;</span><br></pre></td></tr></table></figure><p>从上面的例子可以看出,使用macro和nested指令可以非常容易地实现页面装饰效果,此外,还可以在使用nested指令时,指定一个或多个循环变量,看如下代码:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro book&gt;</span><br><span class="line">&lt;#nested 1&gt;      //使用book指令时指定了一个循环变量值</span><br><span class="line">&lt;#nested 2&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@book ;x&gt; $&#123;x&#125; .图书&lt;/@book&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当使用nested指令传入变量值时,在使用该自定义指令时,就需要使用一个占位符(如book指令后的;x).上面的代码输出文本如下:</span><br><span class="line">1 .图书    2 .图书</span><br></pre></td></tr></table></figure><p>在nested指令中使用循环变量时,可以使用多个循环变量,看如下代码:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro repeat count&gt;</span><br><span class="line">&lt;#list 1..count as x&gt;     //使用nested指令时指定了三个循环变量</span><br><span class="line">   &lt;#nested x, x/2, x==count&gt;</span><br><span class="line">&lt;/#list&gt;</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@repeat count=4 ; c halfc last&gt;</span><br><span class="line">$&#123;c&#125;. $&#123;halfc&#125;&lt;#if last&gt; Last! &lt;/#if&gt;</span><br><span class="line">&lt;/@repeat&gt;</span><br><span class="line">上面的输出结果为:</span><br><span class="line">1. 0.5   2. 1   3. 1.5   4. 2 Last;</span><br></pre></td></tr></table></figure><p>return指令用于结束macro指令,一旦在macro指令中执行了return指令,则FreeMarker不会继续处理macro指令里的内容,看如下代码:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;#macro book&gt;</span><br><span class="line">spring</span><br><span class="line">&lt;#return&gt;</span><br><span class="line">j2ee</span><br><span class="line">&lt;/#macro&gt;</span><br><span class="line">&lt;@book /&gt;</span><br></pre></td></tr></table></figure><p>上面的代码输出:spring,而j2ee位于return指令之后,不会输出.</p></div><div style="color:#2196F3">---------------------------------------------本文完，感谢您的阅读---------------------------------------------</div></article><div class="toc-container"><div id="toc" class="toc-article"><strong class="toc-title">目录</strong><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#模板引擎执行流程"><span class="toc-text">模板引擎执行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FTL指令规则"><span class="toc-text">FTL指令规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#插值规则"><span class="toc-text">插值规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表达式"><span class="toc-text">表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FreeMarker的常用指令"><span class="toc-text">FreeMarker的常用指令</span></a></li></ol></div></div></div><div class="copyright"><span>本作品采用</span> <a href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a> <span>进行许可。 转载时请注明原文链接。</span></div><div class="share" style="width:100%"><img src="http://wx4.sinaimg.cn/mw690/0077hIeDly1fz58snp402j308c08ct8k.jpg" alt="Running Geek" style="margin:auto;display:block"><div style="margin:auto;text-align:center;font-size:.9em;color:grey;color:#2196f3">Learn from each other</div></div><div class="post-nav"><div class="post-nav-item post-nav-next"><span>〈 </span><a href="/2019/01/19/Docker/" rel="next" title="Docker">Docker</a></div><div class="post-nav-item post-nav-prev"></div></div><section class="disqus-comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section><script>var disqus_shortname="XXX",disqus_url="https://swushxw.github.io/2019/01/28/FreeMarker/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/count.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script id="dsq-count-scr" src="//XXX.disqus.com/count.js" async></script></div></div><footer class="footer text-center"><div id="bottom-inner"><a class="bottom-item" href="https://github.com/SwuShxw/swushxw.github.io.git">首页</a> | <a class="bottom-item" href="https://github.com/SwuShxw" target="_blank">GitHub</a> | <a class="bottom-item" href="https://hexo.io" target="_blank">Powered by hexo</a> | <a class="bottom-item" href="https://github.com/KevinOfNeu/hexo-theme-xoxo" target="_blank">Theme xoxo</a></div></footer><script>!function(e,t,n){function o(){cancelAnimationFrame(d),d=requestAnimationFrame(function e(){var n=t.body.scrollTop||t.documentElement.scrollTop;n>0?(t.body.scrollTop=t.documentElement.scrollTop=n-50,d=requestAnimationFrame(e)):cancelAnimationFrame(d)})}function a(){c(".heart{z-index:9999;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),r(),i(),m()}function i(){for(var e=0;e<u.length;e++)u[e].alpha<=0?(t.body.removeChild(u[e].el),u.splice(e,1)):(u[e].y--,u[e].scale+=.004,u[e].alpha-=.013,u[e].el.style.cssText="left:"+u[e].x+"px;top:"+u[e].y+"px;opacity:"+u[e].alpha+";transform:scale("+u[e].scale+","+u[e].scale+") rotate(45deg);background:"+u[e].color);requestAnimationFrame(i)}function r(){var n="function"==typeof e.onclick&&e.onclick,a=t.getElementById("logo");a&&(a.onclick=function(e){o(),n&&n(),l(e)})}function l(e){var n=t.createElement("div");n.className="heart",u.push({el:n,x:e.clientX-5,y:e.clientY-5,scale:1,alpha:1,color:s()}),t.body.appendChild(n)}function c(e){var n=t.createElement("style");n.type="text/css";try{n.appendChild(t.createTextNode(e))}catch(o){n.styleSheet.cssText=e}t.getElementsByTagName("head")[0].appendChild(n)}function s(){return"#F44336"}function m(){var e=t.getElementById("menu-main-post");if(e){var n=t.getElementById("toc");n?e.onclick=function(){n&&("block"==n.style.display?n.style.display="none":n.style.display="block")}:e.style.display="none"}}var d=null,u=[];e.requestAnimationFrame=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}}(),a()}(window,document)</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="//hm.baidu.com/hm.js?FuckUBaidu";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(e,a,t,n,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(t),s=a.getElementsByTagName(t)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","XXX","auto"),ga("send","pageview")</script><script type="text/javascript" src="/js/love.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html><!-- rebuild by neat -->